---
title: "Bayesian Hierarchical Models in Finance"
author: "Yun Yan"
date: "4/2/2017"
output:
  word_document: 
    fig_caption: yes
    toc: yes
  pdf_document:
    fig_caption: yes
    number_sections: yes
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Solution

```{r}
library(rstan)
library(ggplot2)
library(dplyr)
library(readr)
library(readxl)
library(scales)
```

I am going to apply bayesian hierarchical models for solving following example problems as solutions to hopefully pass the project tests.

- Simple multivariate regression
- Multivariate regression with groupings

```{r}
DIRDATA <- './data'
DIRFIG  <- './fig'
if (!dir.exists(DIRFIG)) {dir.create(DIRFIG)}
if (!dir.exists(DIRDATA)) {dir.create(DIRDATA)}
```

## Perform simple multivariate regression on Istanbul Stock Exchange Dataset

```{r}
## Fetch and reading stock data
file_url <- 'https://archive.ics.uci.edu/ml/machine-learning-databases/00247/data_akbilgic.xlsx'
file_path <- file.path(DIRDATA, 'istanbul.xlsx')
download.file(url = file_url, 
              destfile = file_path,
              method = 'wget', quiet = T)
istanbul <- read_excel(file_path, 
                       skip = 1)
colnames(istanbul)[2:3] <- c('ISE_TL', 'ISE_USD')
print(head(istanbul))
```

```{r}
## Scaled dataset
istanbul2 <- dplyr::select(istanbul, -date, -ISE_TL) %>%
  scale() %>% as.data.frame()
```

```{r, echo=FALSE}
## classical linear model
istanbul_lm <- lm(ISE_USD ~ ., data = istanbul2)
summary(istanbul_lm)
```



## Perform multivariate regression with groups on Insurance Company Benchmark dataset

```{r}
file_url <- 'https://archive.ics.uci.edu/ml/datasets/Insurance+Company+Benchmark+%28COIL+2000%29'
# multivariate regression with training and prediction
```

